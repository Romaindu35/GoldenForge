--- a/net/minecraft/world/gen/ChunkGenerator.java
+++ b/net/minecraft/world/gen/ChunkGenerator.java
@@ -2,10 +_,8 @@
 
 import com.google.common.collect.Lists;
 import com.mojang.serialization.Codec;
-import java.util.BitSet;
-import java.util.List;
-import java.util.ListIterator;
-import java.util.Random;
+
+import java.util.*;
 import java.util.function.Function;
 import java.util.function.Supplier;
 import javax.annotation.Nullable;
@@ -227,10 +_,26 @@
       Biome biome = this.field_222542_c.func_225526_b_((chunkpos.field_77276_a << 2) + 2, 0, (chunkpos.field_77275_b << 2) + 2);
       this.func_242705_a(StructureFeatures.field_244145_k, p_242707_1_, p_242707_2_, p_242707_3_, p_242707_4_, p_242707_5_, chunkpos, biome);
 
-      for(Supplier<StructureFeature<?, ?>> supplier : biome.func_242440_e().func_242487_a()) {
-         this.func_242705_a(supplier.get(), p_242707_1_, p_242707_2_, p_242707_3_, p_242707_4_, p_242707_5_, chunkpos, biome);
+      Iterator iterator = biome.func_242440_e().func_242487_a().iterator();
+
+      while (iterator.hasNext()) {
+         Supplier<StructureFeature<?, ?>> supplier = (Supplier) iterator.next();
+
+         // CraftBukkit start
+         StructureFeature<?, ?> structurefeature = (StructureFeature) supplier.get();
+         if (structurefeature.field_242770_c == StructureFeatures.field_244145_k) {
+            synchronized (structurefeature) {
+               this.func_242705_a(structurefeature, p_242707_1_, p_242707_2_, p_242707_3_, p_242707_4_, p_242707_5_, chunkpos, biome);
+            }
+         } else {
+            this.func_242705_a(structurefeature, p_242707_1_, p_242707_2_, p_242707_3_, p_242707_4_, p_242707_5_, chunkpos, biome);
+         }
+         // CraftBukkit end
       }
 
+//      for(Supplier<StructureFeature<?, ?>> supplier : biome.getGenerationSettings().structures()) {
+//         this.createStructure(supplier.get(), p_242707_1_, p_242707_2_, p_242707_3_, p_242707_4_, p_242707_5_, chunkpos, biome);
+//      }
    }
 
    private void func_242705_a(StructureFeature<?, ?> p_242705_1_, DynamicRegistries p_242705_2_, StructureManager p_242705_3_, IChunk p_242705_4_, TemplateManager p_242705_5_, long p_242705_6_, ChunkPos p_242705_8_, Biome p_242705_9_) {
